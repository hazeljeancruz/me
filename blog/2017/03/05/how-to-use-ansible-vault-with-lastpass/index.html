<!doctype html> <html lang=en> <head> <meta charset=utf-8 /> <meta http-equiv=X-UA-Compatible content='IE=edge;chrome=1'/> <meta name=author content="Wojciech Adam Koszek"> <meta name=viewport content="width=device-width, initial-scale=1"> <meta name="p:domain_verify" content=35dedfd4f697e6e974b0ae6631ca7351 /> <!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script> <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]--> <link rel=stylesheet media=none onload="if(media!='all')media='all'" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> <link rel=stylesheet media=none onload="if(media!='all')media='all'" href="/css/1406-fonts.css"> <link rel=stylesheet media=none onload="if(media!='all')media='all'" href="/css/debug.css"> <link rel=stylesheet media=none onload="if(media!='all')media='all'" href="/css/code.css"> <script src="https://code.jquery.com/jquery-git.min.js"></script> <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-8027537-3', 'auto');
  ga('send', 'pageview');
</script> <script>
	(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
	(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
	e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
	})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
	_st('install','_i_CdLX9xwxixHZtjxHu','2.0.0');
</script> <link rel=icon type="image/png" href="/img/favicon.ico"> <title>How to use Ansible Vault with LastPass</title> <meta name=description content="I give you the tool which will help you keep your Ansible Vault passwords in LastPass. I show how to use it as well. "/> <meta property="og:title" content="How to use Ansible Vault with LastPass"/> <meta property="og:description" content="I give you the tool which will help you keep your Ansible Vault passwords in LastPass. I show how to use it as well. "/> <meta property="og:image" content="https://www.koszek.com/img/2017-03-05-how-to-use-ansible-vault-with-lastpass/james-sutton-187816_10p.jpg"/> <meta name="twitter:card" content=summary_large_image> <meta name="twitter:site" content="@wkoszek"/> <meta name="twitter:creator" content="@wkoszek"/> <meta name="twitter:title" content="How to use Ansible Vault with LastPass"/> <meta name="twitter:description" content="I give you the tool which will help you keep your Ansible Vault passwords in LastPass. I show how to use it as well. "/> <meta name="twitter:image" content="https://www.koszek.com/img/2017-03-05-how-to-use-ansible-vault-with-lastpass/james-sutton-187816_10p.jpg"/> <meta property="og:type" content=article /> <meta property="article:author" content="https://www.koszek.com/about"/> <meta property="article:publisher" content="https://www.koszek.com/"/> <link rel=alternate type="application/atom+xml" title="Atom Feed" href="/feed.xml"/> </head> <body> <div class=container> <div class="row noprint"> <div class="col-md-3 logo"> <a href="/">Wojciech Adam Koszek</a> </div> <div class="col-md-9 links hidden-sm hidden-xs"> <a class=in id=blog href="/">Blog</a> <a class=in id=reading href="/reading/">Reading</a> <a class=in id=papers href="/papers/">Papers</a> <a class=in id=about href="/about/">About me</a> <input class=st-default-search-input> </div> </div> <div class="row noprint"> <hr/> </div> <div class="row hidden-md hidden-lg links noprint"> <div class=col-xs-4> <br> <a class=in href="/">Blog</a> </div> <div class=col-xs-4> <br> <a class=in href="/reading/">Reading</a> </div> <div class=col-xs-4> <br> </div> </div> <div class="row hidden-md hidden-lg links noprint"> <div class=col-xs-4> <br> <a class=in href="/papers/">Papers</a> </div> <div class=col-xs-4> <br> <a class=in href="/about/">About</a> </div> <div class=col-xs-4> <br> <a class="hidden-lg hidden-md" href="#notes">Notes</a> </div> </div> <div class="row hidden-md hidden-lg links text-center noprint"> <br> <input class=st-default-search-input> </div> <div class=row> <div class="col-md-2 leftpanel hidden-xs hidden-sm"> </div> <div class="col-md-7 content"> <article> <h1 class=title>How to use Ansible Vault with LastPass</h1> <i>by Wojciech Adam Koszek</i> &nbsp;&nbsp;&sdot;&nbsp;&nbsp; <i>Mar 5, 2017</i> &nbsp;&nbsp;&sdot;&nbsp;&nbsp; <i>Menlo Park, CA</i> <br/> <br/> <b>I give you the tool which will help you keep your Ansible Vault passwords in LastPass. I show how to use it as well. </b> <br/> <hr class=noprint /> <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f9a67fb0188b069" async=async></script> <div class=addthis_sharing_toolbox></div> <hr class=noprint /> <div class=article_body> <p>There are several competitors for password managers. I use <a href="https://www.lastpass.com">LastPass</a>, because it has an Open Source <a href="https://github.com/lastpass/lastpass-cli">command line client</a>. This is an officially supported tool, maintained by the LastPass itself. I haven’t audited the code; I have just looked at several <code>.c</code> files, and it seamed decent. Code has been around since 2014, so in the last three years I suspect both good and bad guys had a chance to find issues.</p> <p><a href="http://docs.ansible.com/ansible/playbooks_vault.html">Ansible Vault</a> is a <a href="https://www.ansible.com">Ansible</a> solution for managing secrets. Principle is similar to LastPass: you have a blob file protected by a master password. When you deploy code to the server, this blob is unencrypted and passwords are put in the right place of your choice. So for example <code>database.php</code> may have a database password placeholder, and Ansible will put a password there, but just during deployment. The code in Git won’t have this password in plain-text. People use Vault because “blob file” can be checked-in to the Git repository. It’s secure as long as your master password is very strong.</p> <p>Here I will show you how to keep this Ansible Vault password strong by using LastPass, its command-line client, and the <a href="https://github.com/wkoszek/lastpass-ansible">lastpass-ansible</a> tool which I wrote. At the end, your flow will enable you to login to LastPass from the command line. You’ll do it just once, during your work session. Then, you’ll be able to keep using Ansible Vault with your passwords automatically channeled from LastPass.</p> <p>This is a sister-tool to <a href="https://github.com/wkoszek/lastpass-ssh">lastpass-ssh</a> which does the same thing for SSH key passphrases.</p> <p><img src="/img/2017-03-05-how-to-use-ansible-vault-with-lastpass/james-sutton-187816_10p.jpg" alt=alt_text_0 title=Image_text_0 /> <br/> <small><small><small> <em>(Photo by <a href="https://unsplash.com/@jamessutton_photography">James Sutton</a> via <a href="https://www.unsplash.com">Unsplash</a>)</em> </small></small></small></p> <h2 id=how-to-install>How to install</h2> <p>You install the tool in the terminal:</p> <pre class="highlight plaintext"><code>gem install lastpass-ansible
</code></pre> <h2 id=how-to-use>How to use</h2> <p>You must point Ansible to use <code>lastpass-ansible</code>:</p> <pre class="highlight plaintext"><code>export ANSIBLE_VAULT_PASSWORD_FILE=`command -v lastpass-ansible`
</code></pre> <p>Now assume you’re in your web application directory:</p> <pre class="highlight plaintext"><code>cd ~/Projects/my_web_app
</code></pre> <p>To initialize everything, do:</p> <pre class="highlight plaintext"><code>lastpass-ansible --init
</code></pre> <p>This will create a new 30-character long password and put it in <code>Ansible_Vault/my_web_app</code> LastPass hierarchy. If you want to “transfer” your vault file <code>secrets.yml</code> to <code>lastpass-ansible</code>, copy the new password to clipboard:</p> <pre class="highlight plaintext"><code>lpass show -c -p Ansible_Vault/my_web_app
</code></pre> <p>And just re-key (change password) for your existing vault:</p> <pre class="highlight plaintext"><code>ansible-vault rekey secrets.yml
</code></pre> <p>Type your old password, and paste your new password.</p> <p>File <code>.lastpass-ansible.conf</code> has been created along with the password. You can remove this file if the hierarchy <code>Ansible_Vault/....</code> is fine with you.</p> <h2 id=more-details-and-custom-settings>More details and custom settings</h2> <p>If you’re a picky person and you don’t like <code>Ansible_Vault</code> OR you want to point <code>lastpass-ansible</code> to an existing hierarchy of your passwords, just stick it to <code>.lastpass-ansible.conf</code>. It’s format is very easy:</p> <pre class="highlight plaintext"><code># lastpass-ansible configuration file. For more details read:
# https://github.com/wkoszek/lastpass-ansible
MyWebSites/my_web_app
</code></pre> <p>The order of lookup for this LastPass site name is:</p> <ol> <li><code>.lastpass-ansible.conf</code> file</li> <li><code>LASTPASS_ANSIBLE_NAME</code> environment variable</li> <li>Name guessed based on a directory: “Ansible_Vault” + name</li> </ol> <p>It should be safe to commit <code>.lastpass-ansible.conf</code> to your repository. If you’re paranoid, just use <code>LASTPASS_ANSIBLE_NAME</code> environment variable for passing this name. Otherwise just use the guessed name. I think it’s the most convenient.</p> <h2 id=summary>Summary</h2> <p><strong>Shoot me an email if this flow worked for you</strong>. I used a shell-based equivalent of this flow for some time and it worked all right. The <code>lastpass-ansible</code> is my attempt to bring it to more people to help with productivity. My hope is to improve this method by exposing it to people and getting some criticism. Let me know if you find bugs or issues here.</p> <h2 id=github>GitHub</h2> <p>It’s maintained in this GitHub repository:</p> <p><a href="https://github.com/wkoszek/lastpass-ansible">https://github.com/wkoszek/lastpass-ansible</a></p> <p><a href="https://travis-ci.org/wkoszek/lastpass-ansible"><img src="https://travis-ci.org/wkoszek/lastpass-ansible.svg?branch=master" alt="Build Status"/></a></p> </div> </article> <div class="row noprint"> <br> <div class="col-md-6 text-left"> </div> <div class="col-md-6 text-right"> </div> </div> <div class=noprint> <hr> <h3 id=mailing-list>Subscribe for updates</h3> <p> Once a month I send updates on the new content and hints for software engineers. <div id=mc_embed_signup class=row> <form action="//koszek.us3.list-manage.com/subscribe/post?u=0cfe70aa4cdf848b2adbd70c6&amp;id=bc454f0778" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=validate target=_blank novalidate> <div id=mc_embed_signup_scroll class=col-md-12> <input type=email value="" name=EMAIL class="required email" id=mce-EMAIL placeholder="Enter E-mail here"> <div id=mce-responses class=clear> <div class=response id=mce-error-response style="display:none"></div> <div class=response id=mce-success-response style="display:none"></div> </div> <div style="position: absolute; left: -5000px;"><input name=b_0cfe70aa4cdf848b2adbd70c6_bc454f0778 tabindex=-1 value=""></div> <div class=clear><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class=button width="100%"></div> </div> </form> </div> </p> <hr> <b>Liked it? Share it!</b> <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f9a67fb0188b069" async=async></script> <div class=addthis_sharing_toolbox></div> <hr> <p><br/> <strong>About the author:</strong> I’m Wojciech Adam Koszek. I like software, business and design. Poland native. In Bay Area since 2010.   <a href="/about/">More about me…</a></p> <hr> <div id=disqus_thread></div> <script>

var disqus_config = function () {
this.page.url = document.location.href.split('?')[0].split('#')[0];
this.page.identifier = this.page.url;
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//koszek.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> </div> <div class=col-md-1> </div> <div class="col-md-2 rightpanel noprint"> <br><h4>Mailing list</h4> <a href="#mailing-list">Subscribe</a> <br><h4>RSS feed</h4> <a href="http://www.koszek.com/feed.xml">RSS</a> <h4>Contact</h4> <a href="mailto:wojciech@koszek.com">E-mail</a><br> <a href="https://twitter.com/wkoszek/">Twitter</a><br> <a href="https://www.linkedin.com/in/wkoszek/">LinkedIn</a><br> <a href="https://github.com/wkoszek/">Github</a><br> <h4>Tags</h4> <span class=tag> <a href="/blog/tags/software-engineering">software engineering</a> </span> <br> <span class=tag> <a href="/blog/tags/tools">tools</a> </span> <br> <span class=tag> <a href="/blog/tags/entrepreneurship">entrepreneurship</a> </span> <br> <span class=tag> <a href="/blog/tags/productivity">productivity</a> </span> <br> </div> </div> <div class="row noprint"> <div class="col-md-12 footer"> <i>&copy;&nbsp;2012&dash;2017 Wojciech Adam Koszek (<a href="https://www.twitter.com/wkoszek/">@wkoszek</a>)</i> <br> Visits so far: <script>
var sc_project=10468040; 
var sc_invisible=0; 
var sc_security="b542d462"; 
var sc_text=2; 
var scJsHost = (("https:" == document.location.protocol) ?  "https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" + scJsHost+ "statcounter.com/counter/counter.js'></"+"script>");
</script> <noscript> <div class=statcounter> <a title="free web stats" href="https://statcounter.com/free-web-stats/" target=_blank> <img class=statcounter src="https://c.statcounter.com/10468040/0/b542d462/0/" alt="free web stats"/></a> </div> </noscript> </div> </div> </div> <script>
        var active_page_elem = document.getElementById('active_page_name')
        var active_page_name = (active_page_elem != null ? active_page_elem.textContent : "blog");
        var active_page_link = document.getElementById(active_page_name);
        active_page_link.className = "ac";
    </script> </body> </html>